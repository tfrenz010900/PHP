<?php
ob_start();
$bypasslogin = true;
include_once $_SERVER['DOCUMENT_ROOT']."/includes/functions_inc.php";

function RenderHTMLPixel($obj) {
  $colorparts = str_split($obj,2);
  $red_hex = (string)$colorparts[0];
  $green_hex = (string)$colorparts[1];
  $blue_hex = (string)$colorparts[2]; 
   if ($red_hex == "00" && $green_hex == "00" && $blue_hex == "00") {
	 $red_hex = $green_hex = $blue_hex = 'ff';
   }
  return $red_hex.$green_hex.$blue_hex;  	
}

function DrawBoxFromString($inputstring) {
  $reverserowpixesl = array_merge(range(30,59),range(90,119),range(150,179),range(210,239),range(270,299),range(330,359),range(390,419),range(450,479),range(510,539),range(570,599),range(630,659),range(690,719),range(750,779));
  $offsetarray = array(29,27,25,23,21,19,17,15,13,11,9,7,5,3,1,-1,-3,-5,-7,-9,-11,-13,-15,-17,-19,-21,-23,-25,-27,-29,29);
  $string_array = str_split($inputstring,6);
  $counter = $counter_blobal = $counter_blobal_show = 0;
  $ledgrid = '<tr>';
  foreach ($string_array as $obj) {
	$bgcolor_display = RenderHTMLPixel($obj);
	$bgcolor_data = str_replace("ffffff", "000000", $bgcolor_display);
	$counter_blobal_show = (in_array($counter_blobal_show, $reverserowpixesl)) ? ($counter_blobal_show + $offsetarray[$counter]) : $counter_blobal_show; 
      if($counter == 30) { 
  	    $ledgrid .= '</tr><tr><td class="cellpixel" data-cell_id="'.$counter_blobal_show.'" id="cell_'.$counter_blobal_show.'" data-bgcolor="'.$bgcolor_data.'" style="background-color:'.$bgcolor_display.';">'.$counter_blobal_show.'</td>';	
  	    $counter = 1;
      } else {
  	    $ledgrid .= '<td class="cellpixel" data-cell_id="'.$counter_blobal_show.'" id="cell_'.$counter_blobal_show.'" data-bgcolor="'.$bgcolor_data.'" style="background-color:'.$bgcolor_display.';">'.$counter_blobal_show.'</td>';
  	    $counter++;
      }
    $counter_blobal_show = $counter_blobal;  
    $counter_blobal++;
    $counter_blobal_show++;
  }	 
  $ledgrid .= '</tr>'; 	
  return $ledgrid;
}

function CreateStringFromCoords($clearscreen = true,$incoords,$ledmatrix) {
  global $ledmatrix,$totalleds;	
	if($clearscreen || empty($ledmatrix)) {
	 $ledmatrix = array();
	 for ($x = 0; $x <= $totalleds; $x++) {
	  $ledmatrix[$x] = "000000";
	 }
	}	
      $counter_blobal = 0;
      $individualcoord_array = explode("|", $incoords);	
      $pos_1_array = explode(",", $individualcoord_array[0]);
       $intCol_pos_1 = (int)$pos_1_array[0];
       $intRow_pos_1 = (int)$pos_1_array[1];	       
      $pos_2_array = explode(",", $individualcoord_array[1]);
       $intCol_pos_2 = (int)$pos_2_array[0];
       $intRow_pos_2 = (int)$pos_2_array[1];
      $color = $individualcoord_array[2];      	      
    for ($intRow = 1; $intRow <= 26; $intRow++) { 	      
     for ($intCol = 1; $intCol <= 30; $intCol++) {
       if($intRow >= $intRow_pos_1 && 
          $intCol >= $intCol_pos_1 && 
          $intRow <= $intRow_pos_2 && 
          $intCol <= $intCol_pos_2) {
            $ledmatrix[$counter_blobal] = $color;  
       }
      $counter_blobal++;
     }
    }   
  return implode("",$ledmatrix);
}


//$inputstring = "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009000009000009000009000009000009000009000009000009000009000009000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009000009000009000009000009000009000009000009000009000009000009000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009000009000009000009000009000009000009000009000009000009000009000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009000009000009000009000009000009000009000009000009000009000009000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009000009000009000009000009000009000009000009000009000009000009000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009000009000009000009000009000009000009000009000009000009000009000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009000009000009000009000009000009000009000009000009000009000009000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009000009000009000009000009000009000009000009000009000009000009000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009000009000009000009000009000009000009000009000009000009000009000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009000009000009000009000009000009000009000009000009000009000009000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009000009000009000009000009000009000009000009000009000009000009000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
//$ledgrid = DrawBoxFromString($inputstring);

//$inputstring = "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
//$ledmatrix = str_split($inputstring,6);


$ledgrid = DrawBoxFromString(CreateStringFromCoords(true,'10,3|21,20|00f000',$ledmatrix));
//$ledgrid = DrawBoxFromString(CreateStringFromCoords(false,'20,2|28,20|f00000',$ledmatrix));
?>
<!DOCTYPE>
<html lang="en">
<head>
  <title>SmartMitt</title>
  <script type="text/javascript" src="/vendor/jquery/jquery.min.js"></script>
    <style>
      table.PixelTable {
        border: 0px solid #f5f5f5;
        border-spacing: 3px 13px;
        background-color: #ffffff;
        text-align: center;
         padding: 0px 0px;
      }
      table.PixelTable td, table.PixelTable th {
        border: 1px solid #cccccc;
        padding: 2px 0px;
        width: 20px;
        height: 20px;  
      }
      table.PixelTable tbody td {
        font-size: 10px;
      }
      table.PixelTable td.highlighted {
  
      }
      .activecell {
	    border: 3px solid #000000 !important;   
      }
    </style>
</head>
<body>
<script type="text/javascript"> 
  var chosencolor = "f00000";
  var pixelcolorstring = '';
  var isMouseDown = false;
  var isHighlighted = false; 
  var totalleds = <?=$totalleds?>; 	
  $(document).ready(function(){	
     $("#PixelTable td")
       .mousedown(function () {
         isMouseDown = true;
         $(this).toggleClass("highlighted");
         isHighlighted = $(this).hasClass("highlighted");
	       if(isHighlighted) {
		     $(this).css('background-color',"#"+chosencolor);
		     $(this).data('bgcolor',chosencolor);
	       } else {
		     $(this).css('background-color',"#ffffff");
		     $(this).data('bgcolor',"000000");  
	       }          
         return false;
       })
       .mouseover(function () {
         if (isMouseDown) {
           $(this).toggleClass("highlighted", isHighlighted);	         
	       if(isHighlighted) {
		     $(this).css('background-color',"#"+chosencolor);
		     $(this).data('bgcolor',chosencolor); 		     
	       } else {
		     $(this).css('background-color',"#ffffff");
		     $(this).data('bgcolor',"000000"); 
	       }  	                 
         }
       })
  
       $(document).mouseup(function () {
         isMouseDown = false;      
       });    
    
    $(".pixelcolor").on("click", function(event) {
	   $(".pixelcolor").removeClass('activecell');
	   $(this).addClass('activecell');
	   chosencolor = $(this).data('colorchip');
	           
    }); 
    
    $("#serializematrix").on("click", function(event) {
      SerializePixelMap(); 
    });       
  });
  
  
 function SerializePixelMap() {
   pixelcolorstring = '';
   for (i = 0; i < totalleds; i++) {
    pixelcolorstring += $("#cell_"+i).data('bgcolor');
   }  
    //console.log(pixelcolorstring);		 
 } 
</script> 
  <table class="PixelTable">
	<tbody>
	 <tr>
	  <td class="pixelcolor activecell" data-colorchip="f00000" style="background-color:#f00000"></td>
	  <td class="pixelcolor" data-colorchip="900000" style="background-color:#900000"></td>
	  <td class="pixelcolor" data-colorchip="400000" style="background-color:#400000"></td>	  
	  <td class="pixelcolor" data-colorchip="00f000" style="background-color:#00f000"></td>	  
	  <td class="pixelcolor" data-colorchip="009000" style="background-color:#009000"></td>	  
	  <td class="pixelcolor" data-colorchip="004000" style="background-color:#004000"></td>	  
	  <td class="pixelcolor" data-colorchip="0000f0" style="background-color:#0000f0"></td>	  
	  <td class="pixelcolor" data-colorchip="000090" style="background-color:#000090"></td>	  
	  <td class="pixelcolor" data-colorchip="000040" style="background-color:#000040"></td>	  
	  <td class="pixelcolor" data-colorchip="f0f000" style="background-color:#f0f000"></td>	  
	  <td class="pixelcolor" data-colorchip="909000" style="background-color:#909000"></td>	  
	  <td class="pixelcolor" data-colorchip="404000" style="background-color:#404000"></td>	  
	  <td class="pixelcolor" data-colorchip="f0f0f0" style="background-color:#f0f0f0"></td>	  
	  <td class="pixelcolor" data-colorchip="909090" style="background-color:#909090"></td>	  
	  <td class="pixelcolor" data-colorchip="404040" style="background-color:#404040"></td>	
	  <td class="pixelcolor" data-colorchip="000000" style="background-color:#000000"></td>
	  <td><button id="serializematrix" type="button" class="btn btn-primary btn-sm">Serialize</button></td>		   	  
	 </tr>
	</tbody>
  </table>
  <table id="PixelTable" class="PixelTable">
   <tbody>
    <?=$ledgrid?>
   </tbody>
  </table>
</body>
</html>