<?php
 $bypasslogin = true;
  include_once $_SERVER['DOCUMENT_ROOT']."/includes/functions_inc.php";
  global $reverserowpixesl,$offsetarray;
  $reverserowpixesl = array_merge(range(30,59),range(90,119),range(150,179),range(210,239),range(270,299),range(330,359),range(390,419),range(450,479),range(510,539),range(570,599),range(630,659),range(690,719),range(750,779));
  $offsetarray = array(29,27,25,23,21,19,17,15,13,11,9,7,5,3,1,-1,-3,-5,-7,-9,-11,-13,-15,-17,-19,-21,-23,-25,-27,-29,29);
  //Incoming Data Request
  $showpixelcelltxt = isset($_REQUEST['showpixelcelltxt']) ? (boolean)$_REQUEST['showpixelcelltxt'] : $showpixelcelltxt;
  $pixeldata = isset($_REQUEST['pixeldata']) ? trim($_REQUEST['pixeldata']) : 'speed=66'; //1,1|30,26|000000 (clear screen) 

  
  function AdjustIntensity($incolorstr) {
	global $ledintensity;
    $alllevels = array("1", "2", "3", "4", "5", "6", "7", "8", "9", "f");	
	$colorparts = str_split($incolorstr,2);
	 $red_seg = str_replace($alllevels, $ledintensity, $colorparts[0]);
	 $blue_seg = str_replace($alllevels, $ledintensity, $colorparts[1]);
	 $green_seg = str_replace($alllevels, $ledintensity, $colorparts[2]); 
	 return $red_seg.$green_seg.$blue_seg;
  }
  
  function AdjustIntensityString($incolorstr) {
	global $ledintensity;
	$fullstring = '';
    $alllevels = array("1", "2", "3", "4", "5", "6", "7", "8", "9", "f");	
    $clolorarray = str_split($incolorstr,6);
      foreach ($clolorarray as $obj) {
	   $led_seg = str_replace($alllevels, $ledintensity, $obj);
	   $fullstring .= $led_seg;
	  }
	 return $fullstring;
  }  
  
  
    if($pixeldata != 'load') { //Process Passed pixel data
      //Speed Digits~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~     
      $SpeedDigitOne = Array('4,4|13,19|'.AdjustIntensity($speedcolor).';7,6|10,17|000000;',
                        '6,4|11,5|'.AdjustIntensity($speedcolor).';8,6|11,17|'.AdjustIntensity($speedcolor).';6,18|13,19|'.AdjustIntensity($speedcolor).';',
                        '4,4|13,19|'.AdjustIntensity($speedcolor).';4,6|10,10|000000;7,13|13,17|000000;',
                        '4,4|13,19|'.AdjustIntensity($speedcolor).';4,6|10,10|000000;4,13|10,17|000000;',
                        '4,4|13,19|'.AdjustIntensity($speedcolor).';7,4|10,10|000000;4,13|10,19|000000;',
                        '4,4|13,19|'.AdjustIntensity($speedcolor).';7,6|13,10|000000;4,13|10,17|000000;',
                        '4,4|13,19|'.AdjustIntensity($speedcolor).';7,6|13,10|000000;7,13|10,17|000000;',
                        '4,4|14,5|'.AdjustIntensity($speedcolor).';11,6|14,19|'.AdjustIntensity($speedcolor).';',
                        '4,4|13,19|'.AdjustIntensity($speedcolor).';7,6|10,10|000000;7,13|10,17|000000;',
                        '4,4|13,12|'.AdjustIntensity($speedcolor).';7,6|10,10|000000;11,13|13,19|'.AdjustIntensity($speedcolor).';');                                
      $SpeedDigitTwo = Array('18,4|27,19|'.AdjustIntensity($speedcolor).';21,6|24,17|000000;',
                        '18,4|23,5|'.AdjustIntensity($speedcolor).';20,6|23,17|'.AdjustIntensity($speedcolor).';18,18|25,19|'.AdjustIntensity($speedcolor).';',
                        '18,4|27,19|'.AdjustIntensity($speedcolor).';18,6|24,10|000000;21,13|27,17|000000;',
                        '18,4|27,19|'.AdjustIntensity($speedcolor).';18,6|24,10|000000;18,13|24,17|000000;',
                        '18,4|27,19|'.AdjustIntensity($speedcolor).';21,4|24,10|000000;18,13|24,19|000000;',
                        '18,4|27,19|'.AdjustIntensity($speedcolor).';21,6|27,10|000000;18,13|24,17|000000;',
                        '18,4|27,19|'.AdjustIntensity($speedcolor).';21,6|27,10|000000;21,13|24,17|000000;',
                        '18,4|28,5|'.AdjustIntensity($speedcolor).';25,6|28,19|'.AdjustIntensity($speedcolor).';',
                        '18,4|27,19|'.AdjustIntensity($speedcolor).';21,6|24,10|000000;21,13|24,17|000000;',
                        '18,4|27,12|'.AdjustIntensity($speedcolor).';21,6|24,10|000000;25,13|27,19|'.AdjustIntensity($speedcolor).';');

	   if(substr(strtolower($pixeldata), 0, 6) == 'speed=') { //Speed Display
		  $isppeddigits_array = explode("=", $pixeldata);		  	
          $passed_speed = $isppeddigits_array[1];
          $passed_speed = (strlen($passed_speed) > 2) ? substr($passed_speed, -2) : $passed_speed;
          $pixeldata = '1,1|30,26|000000;'.$SpeedDigitOne[$passed_speed[0]].$SpeedDigitTwo[$passed_speed[1]];
	   }	   
       //canned Templates THESE ARE TO BE PULLED FROM THE DATA BASE BY KEYWORD~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
       switch (strtolower($pixeldata)) {
        case "target1":
          //EarlyDev
          $pixeldata = "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000000000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000000000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000000000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000000000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000000000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000000000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000000000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000000000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000000000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000000000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000000000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000000000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000000000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000000000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000000000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000000000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000000000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
          break;
        case "target2":
          //Intermediate    
          $pixeldata = "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0000000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0000000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0000000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0000000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0000000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0000000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0000000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0000000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0000000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0000000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0000000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
          break;
        case "target3":
         //Select Develop    
         $pixeldata = "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000000000000000000000000000000000000000000000000000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000f0f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
         break;
        case "target4":
          //Pitch Advantage    
          $pixeldata = "00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000f00000f00000f00000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000f00000f00000f00000f00000000000000000000000000000f00000f00000f00000f00000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000f00000f00000f00000f00000000000000000000000000000f00000f00000f00000f00000f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0000000f00000f00000f00000f00000f00000000000000000000000000000f00000f00000f00000f00000f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0000000f00000f00000f00000f00000f000000000000000000000000000000000000000000000000000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0000000000000000000000000000000000000000000000000000000000000f00000f00000f00000f00000f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0000000f00000f00000f00000f00000f00000000000000000000000000000f00000f00000f00000f00000f000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f00000f0000000f00000f00000f00000f00000f00000000000000000000000000000f00000f00000f00000f00000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000f00000f00000f00000f00000000000000000000000000000f00000f00000f00000f00000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000f00000f00000f00000f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"; 
          break;    
       } 
  
      $ledgrid = '';
      $ledmatrix = (isset($_SESSION["ledmatrix"])) ? $_SESSION["ledmatrix"] : '';
      if ((($totalleds+1) * 6) == strlen($pixeldata)) {
	   //$pixeldata = AdjustIntensityString($pixeldata);	      
       $ledgrid = DrawBoxFromString($pixeldata);
       $ledmatrix = str_split($pixeldata,6);
      } else {
    	$coordssupplied = explode(";", $pixeldata);	
    	$clearscreen = (count($coordssupplied) > 1) ? false : true;	
    	 foreach ($coordssupplied as $obj) {
    	   if (!empty($obj)) {
    	    $ledgrid = DrawBoxFromString(CreateStringFromCoords($clearscreen,$obj,$ledmatrix));
    	   }
    	 } 
      }

      $_SESSION["ledmatrix"] = $ledmatrix;
 
        //Call Python Script to drive display
        $outputfiledata = implode("",$ledmatrix);
        $path_parts = pathinfo($ledpickupfile_loc);
        if(file_exists($path_parts['dirname'])) {  
	      file_put_contents($ledpickupfile_loc, $outputfiledata); 
           if (file_exists($leddriverscript_file)) {
             $output = exec($leddriverscript_loc);
           }
        }
    } else { //Load previous input.txt (no pixel data provided, ajax refresh previous file)
	   $ledmatrix = (isset($_SESSION["ledmatrix"])) ? $_SESSION["ledmatrix"] : '';
	   $pixeldata = (file_exists($ledpickupfile_loc)) ? file_get_contents($ledpickupfile_loc) : DrawBoxFromString(CreateStringFromCoords(true,'1,1|30,26|000000',$ledmatrix));	  
       $ledgrid = DrawBoxFromString($pixeldata);
       $_SESSION["ledmatrix"] = $ledmatrix;          
    }
  
  
//'                     ////
//'                    (o o)                  
//'=================ooO=(_)=Ooo===================================================================++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++  
//RUNTIME FUNCTIONS FOR SCREEN RENDER+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++  
function RenderHTMLPixel($obj) {
  $colorparts = str_split($obj,2);
  $red_hex = (string)$colorparts[0];
  $green_hex = (string)$colorparts[1];
  $blue_hex = (string)$colorparts[2]; 
   if ($red_hex == "00" && $green_hex == "00" && $blue_hex == "00") {
	 $red_hex = $green_hex = $blue_hex = 'ff';
   }
  return $red_hex.$green_hex.$blue_hex;  	
}


function DrawBoxFromString($inputstring) {
  global $showpixelcelltxt,$reverserowpixesl,$offsetarray;
       $row_array = str_split($inputstring,180);
       $displaystring = "";
       $rowcounter = 1;
        foreach ($row_array as $key => $row) { //Flip Even Rows for HTML Display
	      if ($rowcounter % 2 == 0) {
		    $indivled_array = str_split($row,6);
		    $indivled_array = array_reverse($indivled_array);
	      } else {
		    $indivled_array = str_split($row,6);
	      }
	      $displaystring .= implode("",$indivled_array);
	      $rowcounter++;          
	    }   
       $string_array = str_split($displaystring,6);
       $counter = $counter_blobal = $counter_blobal_show = 0;
       $rowcnt = 1;
         $tableout = ($showpixelcelltxt) ? '<tr><th></th>'.PHP_EOL : '';
         for ($x = 1; $x <= 30; $x++) {
       	    $tableout .= ($showpixelcelltxt) ? '<th class="rowwidth">'.$x.'</th>'.PHP_EOL : '<th class="rowwidth">&nbsp;</th>'.PHP_EOL;  
         }
         $tableout.= '</tr><tr>'.PHP_EOL; 
       foreach ($string_array as $obj) {	    
       	$bgcolor_display = RenderHTMLPixel($obj);
       	$bgcolor_data = str_replace("ffffff", "000000", $bgcolor_display);
       	$counter_blobal_show = (in_array($counter_blobal_show, $reverserowpixesl)) ? ($counter_blobal_show + $offsetarray[$counter]) : $counter_blobal_show;
       	$counter_blobal_show_text = ($showpixelcelltxt) ? $counter_blobal_show : '';
       	$rowcnt_txtout = ($showpixelcelltxt) ? $rowcnt : '&nbsp;'; 
           if($counter == 30) {
       	    $tableout.= '</tr><tr><th class="rowheight">'.$rowcnt_txtout.'</th><td class="cellpixel" data-cell_id="'.$counter_blobal_show.'" id="cell_'.$counter_blobal_show.'" data-bgcolor="'.$bgcolor_data.'" style="background-color:#'.$bgcolor_display.';">'.$counter_blobal_show_text.'</td>'.PHP_EOL;	
       	    $counter = 1;
       	    $rowcnt++;
           } else {
       	    if ($counter == 0) {
               $tableout.= '<th class="rowheight">'.$rowcnt_txtout.'</th>'.PHP_EOL;
                $rowcnt++;
       		}	
       	    $tableout.= '<td class="cellpixel" data-cell_id="'.$counter_blobal_show.'" id="cell_'.$counter_blobal_show.'" data-bgcolor="'.$bgcolor_data.'" style="background-color:#'.$bgcolor_display.';">'.$counter_blobal_show_text.'</td>'.PHP_EOL;
       	    $counter++;
           }
         $counter_blobal_show = $counter_blobal;  
         $counter_blobal++;
         $counter_blobal_show++;
       }	 
       $tableout.= '</tr>'.PHP_EOL; 	
  return $tableout;
}

function CreateStringFromCoords($clearscreen = true,$incoords,$ledmatrix) {
  global $ledmatrix,$totalleds,$reverserowpixesl,$offsetarray; 
	if($clearscreen || empty($ledmatrix)) {
	 $ledmatrix = array();
	 for ($x = 0; $x <= $totalleds; $x++) {
	  $ledmatrix[$x] = "000000";
	 }
	}	
      $counter_blobal = $counter_blobal_show = 0;
      $individualcoord_array = explode("|", $incoords);	
      $pos_1_array = explode(",", $individualcoord_array[0]);
       $intCol_pos_1 = (int)$pos_1_array[0];
       $intRow_pos_1 = (int)$pos_1_array[1];	       
      $pos_2_array = explode(",", $individualcoord_array[1]);
       $intCol_pos_2 = (int)$pos_2_array[0];
       $intRow_pos_2 = (int)$pos_2_array[1];
      $color = $individualcoord_array[2];   
    for ($intRow = 1; $intRow <= 26; $intRow++) {		      
     for ($intCol = 1; $intCol <= 30; $intCol++) {
       if($intRow >= $intRow_pos_1 && 
          $intCol >= $intCol_pos_1 && 
          $intRow <= $intRow_pos_2 && 
          $intCol <= $intCol_pos_2) {
	       $indx = (in_array($counter_blobal, $reverserowpixesl)) ? ($counter_blobal + $offsetarray[$intCol-1]) : $counter_blobal;
           //$ledmatrix[$indx] = AdjustIntensity($color); 
           $ledmatrix[$indx] = $color; 
       }
      $counter_blobal++;
     }
    }   
  return implode("",$ledmatrix);
}
?>
<table id="PixelTable" class="PixelTable">
 <tbody>
   <?=$ledgrid?>
 </tbody>
</table>