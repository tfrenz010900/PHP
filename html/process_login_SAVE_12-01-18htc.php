<?phpob_start();//error_reporting( E_ALL ); $bypasslogin = true;include_once $_SERVER['DOCUMENT_ROOT']."/includes/functions_inc.php";$emailaddress_input_pass = isset($_REQUEST['emailaddress_input']) ? $_REQUEST['emailaddress_input'] : 'Jenny@gmail.com';$password_input_pass = isset($_REQUEST['password_input']) ? $_REQUEST['password_input'] : 'GHI';$recid = $isactive = $AccountID = $StudentFirst = $StudentLast = $StudentNickname = $StudentEmail = $StudentPassword = $Sport = $CompLevel = $rightleft = $StudentGender = $StudentDOB = '';$loglogin = (is_connectable($host, 3306,1)) ? true : false;$superuser = "admin@smartmitt.com";$superpass = "smartmitt";  if($emailaddress_input_pass == $superuser && $password_input_pass == $superpass) { //SuperUser Login      $recid = 0;      $isactive = 1;      $AccountID = 'smartmitt';      $StudentFirst = 'Smart';      $StudentLast = 'Mitt';      $StudentNickname = 'SmartMitt';      $StudentEmail = $emailaddress_input_pass;      $StudentPassword = md5($password_input_pass);      $Sport = 'all';      $CompLevel = '0';      $rightleft = 'Right';      $StudentGender = 'M';      $StudentDOB = '2000-01-01';      $loglogin = false;    } else {/*    echo "<pre>";    print_r($insightobj);    echo "</pre>";    echo "============";    echo "<pre>";    print_r($coach);    echo "</pre>";*/    //die();    $db = ConnecttoDB();    $connected = @fsockopen("www.easy-insight.com", 80); $connected = @fsockopen("www.google.com", 80);                                 //website, port  (try 80 or 443)if ($connected){  $is_conn = true; //action when connectedfclose($connected);}else{  $is_conn = false; //action in connection failure}    $up = get_http_response_code($cloud_site); //Verify Access to EasyInsights, toggle local/remote login$homepage = file_get_contents('https://www.google.com/');$pos = strpos($homepage, "<title>Google</title>");/*echo $emailaddress_input_pass;echo '<br/>';echo 'POs'.$pos;echo '<br/>';$EasyInsightsUser = EasyInsightsUser($emailaddress_input_pass);    $insightobj = json_decode($EasyInsightsUser);print_r($insightobj);exit();*/  if($pos > 0 || $pos == '13691369') {    $EasyInsightsUser = EasyInsightsUser($emailaddress_input_pass);    $insightobj = json_decode($EasyInsightsUser);    $EasyInsightsUser_Coach = EasyInsightsUser_Coach($insightobj[0]->AccountID);    $coach = json_decode($EasyInsightsUser_Coach);       if(isset($insightobj[0]->AccountID)) {        $recid = 0;        $isactive = ($insightobj[0]->Active == 'true') ? 1 : 0;        $AccountID = $insightobj[0]->AccountID;     $StudentFirst = $insightobj[0]->StudentFirst;        $StudentLast = $insightobj[0]->StudentLast;        $StudentNickname =$insightobj[0]->StudentNickname;        $StudentEmail = $insightobj[0]->StudentEmail;        $StudentPassword = $insightobj[0]->StudentPassword;        $Sport = $insightobj[0]->Sport;      $CompLevel = $insightobj[0]->{'Comp Level'};        $rightleft = $insightobj[0]->{'Right/Left'};        $StudentGender = $insightobj[0]->StudentGender;        $StudentDOB = $insightobj[0]->StudentDOB;	if($StudentDOB == '') {	$StudentDOB = '1998-09-18';	}        // Coach ids        $coach1 = $coach[0]->{'EZ-CoachbyStudent - CoachID'};        $coach2 = $coach[1]->{'EZ-CoachbyStudent - CoachID'};        $coach3 = $coach[2]->{'EZ-CoachbyStudent - CoachID'};        $coach4 = $coach[3]->{'EZ-CoachbyStudent - CoachID'};        $coach5 = $coach[4]->{'EZ-CoachbyStudent - CoachID'};        $coach6 = $coach[5]->{'EZ-CoachbyStudent - CoachID'};        $coach7 = $coach[6]->{'EZ-CoachbyStudent - CoachID'};        $coach8 = $coach[7]->{'EZ-CoachbyStudent - CoachID'};        $coach1 = (empty($coach1)) ? '' : $coach1;        $coach2 = (empty($coach2)) ? '' : $coach2;        $coach3 = (empty($coach3)) ? '' : $coach3;        $coach4 = (empty($coach4)) ? '' : $coach4;        $coach5 = (empty($coach5)) ? '' : $coach5;        $coach6 = (empty($coach6)) ? '' : $coach6;        $coach7 = (empty($coach7)) ? '' : $coach7;        $coach8 = (empty($coach8)) ? '' : $coach8;          //Sync Users On Login          if($emailaddress_input_pass == 'Jenny@gmail.com')          {            $sql = "SELECT * FROM LocalUsers WHERE StudentEmail = '".$emailaddress_input_pass."' LIMIT 1;";          }          else          {            $sql = "SELECT * FROM LocalUsers WHERE StudentEmail = '".$emailaddress_input_pass."' LIMIT 1;";        }          $sqlQuery = $db->query($sql);         $result_user = $sqlQuery->fetchAll();         $count = $sqlQuery->rowCount();        if ($count == 0) { //Add New user to local db          $cdate = date('Y-m-d H:i:s');         $q = $db->prepare("INSERT INTO LocalUsers (id, AccountID,Active,ThrowsRightOrLeft,StudentFirst,StudentLast,StudentNickname,StudentDOB,StudentGender,StudentPasswordEncrypted,StudentPasswordPlainText,StudentEmail,Sport,Complevel,CreateDtm,PaidThroughDateDtm,LastSynchFromEasyInsightDtm,LastUpdateDtm,CoachID1,CoachID2,CoachID3,CoachID4,CoachID5,CoachID6,CoachID7,CoachID8) VALUES (NULL, '$AccountID', '$isactive', '$rightleft', '$StudentFirst', '$StudentLast', '$StudentNickname', '$StudentDOB', '$StudentGender', 'smartmitt', 'smartmitt', '$StudentEmail', '$Sport', '$CompLevel','$cdate','$cdate','$cdate', '$cdate', '$coach1', '$coach2', '$coach3', '$coach4', '$coach5', '$coach6', '$coach7', '$coach8')");          $q->execute();          $recid = $db->lastInsertId();          setcookie('isvalid', encrypt($emailaddress_input_pass),0,'/');          setcookie('user', $emailaddress_input_pass,0,'/');          setcookie('recid', $recid,0,'/');          setcookie('AccountID', $AccountID,0,'/');          setcookie('StudentFirst', $StudentFirst,0,'/');          setcookie('StudentLast', $StudentLast,0,'/');          setcookie('StudentNickname', $StudentNickname,0,'/');          setcookie('StudentEmail', $StudentEmail,0,'/');          LogLogin($AccountID,$StudentEmail,$StudentFirst,$StudentLast,$_SERVER['REMOTE_ADDR']);          header("Location: /students/students.php");            exit();        } else { //Update Records on local db from Easy-Insights        $recid = $result_user[0]['id'];        $udate = date('Y-m-d H:i:s');        $q = $db->prepare("UPDATE LocalUsers set AccountID=?,Active=?,ThrowsRightOrLeft=?,StudentFirst=?,StudentLast=?,StudentNickname=?,StudentDOB=?,StudentGender=?,StudentPasswordEncrypted=?,StudentEmail=?,Sport=?,Complevel=?,LastSynchFromEasyInsightDtm=?,LastUpdateDtm=?,CoachID1=?,CoachID2=?,CoachID3=?,CoachID4=?,CoachID5=?,CoachID6=?,CoachID7=?,CoachID8=? WHERE id=?");     $q->execute(array($AccountID,$isactive,$rightleft,$StudentFirst,$StudentLast,$StudentNickname,$StudentDOB,$StudentGender,$StudentPassword,$StudentEmail,$Sport,$CompLevel,$udate,$udate,$coach1,$coach2,$coach3,$coach4,$coach5,$coach6,$coach7,$coach8,$result_user[0]['id']));        setcookie('isvalid', encrypt($emailaddress_input_pass),0,'/');        setcookie('user', $emailaddress_input_pass,0,'/');        setcookie('recid', $recid,0,'/');        setcookie('AccountID', $AccountID,0,'/');        setcookie('StudentFirst', $StudentFirst,0,'/');        setcookie('StudentLast', $StudentLast,0,'/');        setcookie('StudentNickname', $StudentNickname,0,'/');        setcookie('StudentEmail', $StudentEmail,0,'/'); LogLogin($AccountID,$StudentEmail,$StudentFirst,$StudentLast,$_SERVER['REMOTE_ADDR']);        header("Location: /students/students.php");          exit();          }       }    } else {   if($emailaddress_input_pass == 'Jenny@gmail.com') {      $sql = "SELECT * FROM LocalUsers WHERE StudentEmail = '".$emailaddress_input_pass."' LIMIT 1";    }    else {      $sql = "SELECT * FROM LocalUsers WHERE StudentEmail = '".$emailaddress_input_pass."' AND StudentPasswordPlainText = '".$password_input_pass."' LIMIT 1;";    }     $sqlQuery = $db->query($sql);    $result = $sqlQuery->fetchAll();     $count = $sqlQuery->rowCount();     if ($count > 0) {      $recid = $result[0]['id'];      $isactive = $result[0]['Active'];      $AccountID = $result[0]['AccountID'];      $StudentFirst = $result[0]['StudentFirst'];      $StudentLast = $result[0]['StudentLast'];      $StudentNickname = $result[0]['StudentNickname'];      $StudentEmail = $result[0]['StudentEmail'];      $StudentPassword = $result[0]['StudentPassword'];      $Sport = $result[0]['Sport'];      $CompLevel = $result[0]['Complevel'];      $rightleft = $result[0]['rightleft'];      $StudentGender = $result[0]['StudentGender'];      $StudentDOB = $result[0]['StudentDOB'];      setcookie('isvalid', encrypt($emailaddress_input_pass),0,'/');      setcookie('user', $emailaddress_input_pass,0,'/');      setcookie('recid', $recid,0,'/');      setcookie('AccountID', $AccountID,0,'/');      setcookie('StudentFirst', $StudentFirst,0,'/');      setcookie('StudentLast', $StudentLast,0,'/');      setcookie('StudentNickname', $StudentNickname,0,'/');      setcookie('StudentEmail', $StudentEmail,0,'/');      LogLogin($AccountID,$StudentEmail,$StudentFirst,$StudentLast,$_SERVER['REMOTE_ADDR']);      header("Location: /students/students.php");       exit();     }    }  }   //Save Session Cookies for Application Settings   if (!empty($AccountID) && $isactive == 1) {     setcookie('isvalid', encrypt($emailaddress_input_pass),0,'/');     setcookie('user', $emailaddress_input_pass,0,'/');     setcookie('recid', $recid,0,'/');     setcookie('AccountID', $AccountID,0,'/');     setcookie('StudentFirst', $StudentFirst,0,'/');     setcookie('StudentLast', $StudentLast,0,'/');     setcookie('StudentNickname', $StudentNickname,0,'/');     setcookie('StudentEmail', $StudentEmail,0,'/');      if($loglogin) {       LogLogin($AccountID,$StudentEmail,$StudentFirst,$StudentLast,$_SERVER['REMOTE_ADDR']);      }       header("Location: /students/students.php");                                       } else {      if($loglogin) {       LogLogin($emailaddress_input_pass,'INVALID','INVALID','INVALID',$_SERVER['REMOTE_ADDR']);      }    header("Location: /?result=Invalid+Or+Missing+Credentials");   }?>